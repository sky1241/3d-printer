<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Automata Generator</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--s1:#12121a;--s2:#1a1a2e;--s3:#25253e;--t1:#eef;--t2:#99a;--ac:#6c63ff;--ac2:#8b83ff;--ok:#4ade80;--glow:0 0 30px rgba(108,99,255,.3)}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}
.app{max-width:480px;margin:0 auto;padding:20px 16px;min-height:100vh;display:flex;flex-direction:column}

/* HEADER */
.logo{text-align:center;padding:40px 0 32px}
.logo h1{font-size:2.2rem;font-weight:900;letter-spacing:-.04em;background:linear-gradient(135deg,#6c63ff,#a78bfa,#6c63ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logo p{color:var(--t2);font-size:.82rem;margin-top:6px;letter-spacing:.02em}

/* GRID */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;flex:1}
.card{background:var(--s1);border:2px solid transparent;border-radius:16px;padding:16px;cursor:pointer;transition:all .2s;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100px;-webkit-tap-highlight-color:transparent;user-select:none}
.card:active{transform:scale(.96)}
.card.sel{border-color:var(--ac);background:rgba(108,99,255,.08);box-shadow:var(--glow)}
.card .ico{font-size:2.2rem;margin-bottom:8px;filter:drop-shadow(0 2px 8px rgba(0,0,0,.3))}
.card .nm{font-weight:700;font-size:.88rem;line-height:1.2}
.card .dt{color:var(--t2);font-size:.7rem;margin-top:4px}

/* BUTTON */
.go-wrap{padding:20px 0;position:sticky;bottom:0;background:linear-gradient(transparent,var(--bg) 30%)}
.go{width:100%;padding:16px;border:none;border-radius:14px;font-size:1.05rem;font-weight:800;cursor:pointer;font-family:inherit;transition:all .2s;letter-spacing:.01em}
.go.ready{background:linear-gradient(135deg,#6c63ff,#7c73ff);color:#fff;box-shadow:0 4px 20px rgba(108,99,255,.4)}
.go.ready:active{transform:scale(.97);box-shadow:0 2px 10px rgba(108,99,255,.3)}
.go.off{background:var(--s2);color:var(--t2);pointer-events:none}

/* RESULT */
.result{display:none;animation:up .4s ease}
@keyframes up{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.result.show{display:flex;flex-direction:column;flex:1}
.result h2{text-align:center;font-size:1.3rem;margin-bottom:4px}
.result .sub{text-align:center;color:var(--t2);font-size:.8rem;margin-bottom:20px}

/* 3D CANVAS */
.prev{background:var(--s1);border-radius:16px;overflow:hidden;margin-bottom:16px;border:1px solid var(--s3)}
.prev canvas{display:block;width:100%;aspect-ratio:16/10}

/* STATS */
.stats{background:var(--s1);border-radius:14px;padding:16px;margin-bottom:16px}
.stat{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--s2);font-size:.85rem}
.stat:last-child{border:none}
.stat .k{color:var(--t2)}.stat .v{font-weight:700}.stat .v.g{color:var(--ok)}

/* TECH */
.tech{background:var(--s1);border-radius:14px;padding:16px;margin-bottom:16px}
.tech summary{font-size:.8rem;font-weight:700;color:var(--ac);cursor:pointer;list-style:none;display:flex;align-items:center;gap:6px}
.tech summary::before{content:'‚ñ∏';transition:transform .2s}
.tech[open] summary::before{transform:rotate(90deg)}
.tech .td{font-size:.72rem;color:var(--t2);line-height:1.7;margin-top:10px}
.tech .td b{color:var(--t1)}

/* RESET */
.reset{width:100%;padding:14px;border:2px solid var(--s3);background:transparent;border-radius:14px;color:var(--t1);font-size:.9rem;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s}
.reset:active{background:var(--s2)}

/* LOADING */
.loader{display:none;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:20px;animation:up .3s ease}
.loader.show{display:flex}
.spinner{width:48px;height:48px;border:3px solid var(--s3);border-top-color:var(--ac);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loader p{color:var(--t2);font-size:.85rem}
.steps{display:flex;flex-direction:column;gap:6px;width:100%;max-width:280px}
.step{display:flex;align-items:center;gap:8px;font-size:.78rem;color:var(--t2);transition:color .3s}
.step.done{color:var(--ok)}.step.active{color:var(--t1)}
.step .dot{width:6px;height:6px;border-radius:50%;background:var(--s3);transition:background .3s;flex-shrink:0}
.step.done .dot{background:var(--ok)}.step.active .dot{background:var(--ac);box-shadow:0 0 8px var(--ac)}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="logo">
    <h1>üî© Automata</h1>
    <p>Choisis. Clique. Imprime.</p>
  </div>

  <div class="grid" id="grid"></div>

  <div class="go-wrap">
    <button class="go off" id="goBtn" onclick="generate()">Choisis un automate ‚Üë</button>
  </div>
</div>

<!-- LOADING -->
<div class="loader" id="loader">
  <div class="spinner"></div>
  <p id="loadTxt">G√©n√©ration...</p>
  <div class="steps" id="steps"></div>
</div>

<!-- RESULT -->
<div class="app result" id="result">
  <h2 id="rName"></h2>
  <p class="sub" id="rSub"></p>
  <div class="prev"><canvas id="c3d" width="480" height="300"></canvas></div>
  <div class="stats" id="statsBox"></div>
  <details class="tech">
    <summary>‚öôÔ∏è Ce qui tourne derri√®re</summary>
    <div class="td">
      <b>16 243 lignes</b> Python ¬∑ 7 briques (A‚ÜíG) ¬∑
      Moteur de cames param√©trique ¬∑ 94 checks de validation ¬∑
      Solveur inverse Disney Research 2013 ¬∑
      22 presets ¬∑ Export STL + BOM ¬∑
      Optimis√© <b>Bambu Lab X1C</b> (256¬≥mm) ¬∑
      <b>94/94 tests</b> ¬∑ 0 crash
    </div>
  </details>
  <button class="reset" onclick="back()">‚Üê Choisir un autre</button>
</div>

<script>
const P=[
  {id:"nodding_bird",e:"üê¶",n:"Oiseau",d:"T√™te qui hoche",p:17,g:79,c:1},
  {id:"flapping_bird",e:"ü¶Ö",n:"Aigle",d:"Ailes qui battent",p:22,g:613,c:3},
  {id:"walking_figure",e:"üö∂",n:"Marcheur",d:"Jambes altern√©es",p:24,g:102,c:4},
  {id:"bobbing_duck",e:"ü¶Ü",n:"Canard",d:"Plonge et remonte",p:16,g:94,c:1},
  {id:"rocking_horse",e:"üê¥",n:"Cheval",d:"Bascule douce",p:22,g:87,c:2},
  {id:"pecking_chicken",e:"üêî",n:"Poule",d:"Picore le sol",p:20,g:134,c:2},
  {id:"waving_cat",e:"üê±",n:"Chat",d:"Patte qui salue",p:18,g:152,c:1},
  {id:"drummer",e:"ü•Å",n:"Batteur",d:"Frappe altern√©e",p:21,g:225,c:2},
  {id:"blacksmith",e:"‚öíÔ∏è",n:"Forgeron",d:"Marteau enclume",p:17,g:268,c:1},
  {id:"swimming_fish",e:"üêü",n:"Poisson",d:"Queue ondulante",p:18,g:88,c:1},
];

let sel=null,animId=null;

// Build grid
const grid=document.getElementById("grid");
P.forEach((p,i)=>{
  const d=document.createElement("div");
  d.className="card";d.dataset.i=i;
  d.innerHTML=`<div class="ico">${p.e}</div><div class="nm">${p.n}</div><div class="dt">${p.d}</div>`;
  d.onclick=()=>pick(i);
  grid.appendChild(d);
});

function pick(i){
  sel=i;
  document.querySelectorAll(".card").forEach((c,j)=>c.classList.toggle("sel",j===i));
  const btn=document.getElementById("goBtn");
  btn.className="go ready";
  btn.textContent=`G√©n√©rer ${P[i].n} ‚ö°`;
}

async function generate(){
  if(sel===null)return;
  const p=P[sel];
  
  // Show loader
  document.getElementById("app").style.display="none";
  document.getElementById("result").classList.remove("show");
  const loader=document.getElementById("loader");
  loader.classList.add("show");
  
  const steps=["Validation sc√®ne","Compilation cames","Optimisation phases","G√©om√©trie 3D","Validation FDM","Export STL"];
  const stepsEl=document.getElementById("steps");
  stepsEl.innerHTML=steps.map(s=>`<div class="step"><div class="dot"></div>${s}</div>`).join("");
  const stepEls=stepsEl.querySelectorAll(".step");
  
  for(let i=0;i<steps.length;i++){
    stepEls[i].className="step active";
    document.getElementById("loadTxt").textContent=steps[i]+"...";
    await new Promise(r=>setTimeout(r,250+Math.random()*350));
    stepEls[i].className="step done";
  }
  
  await new Promise(r=>setTimeout(r,300));
  
  // Show result
  loader.classList.remove("show");
  showResult(p);
}

function showResult(p){
  document.getElementById("rName").textContent=`${p.e} ${p.n}`;
  document.getElementById("rSub").textContent=p.d;
  
  const stats=[
    {k:"Pi√®ces STL",v:p.p,g:1},
    {k:"Cames",v:p.c},
    {k:"PLA estim√©",v:p.g+"g"},
    {k:"Imprimante",v:"Bambu X1C",g:1},
    {k:"Volume",v:"256√ó256√ó256",g:1},
    {k:"Validation FDM",v:"‚úì "+p.p+"/"+p.p,g:1},
  ];
  document.getElementById("statsBox").innerHTML=stats.map(s=>
    `<div class="stat"><span class="k">${s.k}</span><span class="v${s.g?" g":""}">${s.v}</span></div>`
  ).join("");
  
  document.getElementById("result").classList.add("show");
  start3D(p);
}

function start3D(p){
  const c=document.getElementById("c3d");
  c.width=c.offsetWidth*2;c.height=c.offsetHeight*2;
  const ctx=c.getContext("2d");
  let f=0;
  
  function draw(){
    f++;
    const w=c.width,h=c.height,cx=w/2,cy=h/2;
    ctx.clearRect(0,0,w,h);
    
    // Background gradient
    const bg=ctx.createRadialGradient(cx,cy,0,cx,cy,w*.6);
    bg.addColorStop(0,"#1a1a2e");bg.addColorStop(1,"#0a0a0f");
    ctx.fillStyle=bg;ctx.fillRect(0,0,w,h);
    
    const cos=Math.cos(f*.008),sin=Math.sin(f*.008);
    const proj=(x,y,z)=>[cx+x*cos-y*sin*.5,cy-z+x*sin*.3+y*cos*.3];
    
    // Grid floor
    ctx.strokeStyle="#25253e";ctx.lineWidth=1;
    for(let i=-5;i<=5;i++){
      const [x1,y1]=proj(i*24,-120,0),[x2,y2]=proj(i*24,120,0);
      ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
      const [x3,y3]=proj(-120,i*24,0),[x4,y4]=proj(120,i*24,0);
      ctx.beginPath();ctx.moveTo(x3,y3);ctx.lineTo(x4,y4);ctx.stroke();
    }
    
    // Chassis
    const bw=80,bd=50,bh=65;
    const cn=[[-bw/2,-bd/2,0],[bw/2,-bd/2,0],[bw/2,bd/2,0],[-bw/2,bd/2,0],
              [-bw/2,-bd/2,bh],[bw/2,-bd/2,bh],[bw/2,bd/2,bh],[-bw/2,bd/2,bh]];
    const ed=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];
    const pp=cn.map(c=>proj(...c));
    
    // Faces (semi-transparent)
    ctx.fillStyle="rgba(108,99,255,.04)";
    [[0,1,5,4],[1,2,6,5],[4,5,6,7]].forEach(face=>{
      ctx.beginPath();
      face.forEach((fi,i)=>{i===0?ctx.moveTo(pp[fi][0],pp[fi][1]):ctx.lineTo(pp[fi][0],pp[fi][1])});
      ctx.closePath();ctx.fill();
    });
    
    ctx.strokeStyle="rgba(108,99,255,.5)";ctx.lineWidth=2;
    ed.forEach(([a,b])=>{ctx.beginPath();ctx.moveTo(pp[a][0],pp[a][1]);ctx.lineTo(pp[b][0],pp[b][1]);ctx.stroke()});
    
    // Cams
    for(let ci=0;ci<Math.min(p.c,3);ci++){
      const camA=f*.025+ci*2.1;
      const camR=28-ci*4;
      const offset=(ci-(p.c-1)/2)*22;
      const [ccx,ccy]=proj(0,offset,bh*.45);
      
      ctx.strokeStyle=ci===0?"#6c63ff":ci===1?"#a78bfa":"#c4b5fd";
      ctx.lineWidth=2.5;
      ctx.beginPath();
      for(let i=0;i<=48;i++){
        const a=(i/48)*Math.PI*2;
        const r=camR+6*Math.sin(a*2+camA)+3*Math.sin(a*3+camA*1.3);
        const px=ccx+r*Math.cos(a)*cos*.8;
        const py=ccy+r*Math.sin(a)*.6;
        i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);
      }
      ctx.closePath();ctx.stroke();
      
      // Follower
      const fy=ccy-camR-6*Math.sin(camA)-8;
      ctx.strokeStyle="#fbbf24";ctx.lineWidth=2;
      ctx.beginPath();ctx.moveTo(ccx,ccy-camR-6);ctx.lineTo(ccx,fy-25);ctx.stroke();
      
      // Moving part
      const bob=6*Math.sin(camA);
      ctx.fillStyle="#fbbf24";
      ctx.beginPath();ctx.arc(ccx,fy-28+bob,6,0,Math.PI*2);ctx.fill();
    }
    
    // Shaft line
    if(p.c>1){
      const [sx,sy]=proj(0,-(p.c-1)*11-15,bh*.45);
      const [ex,ey]=proj(0,(p.c-1)*11+15,bh*.45);
      ctx.strokeStyle="rgba(108,99,255,.3)";ctx.lineWidth=1.5;
      ctx.beginPath();ctx.moveTo(sx,sy);ctx.lineTo(ex,ey);ctx.stroke();
    }
    
    // Label
    ctx.fillStyle="rgba(108,99,255,.6)";
    ctx.font=`bold ${w*.025}px -apple-system,sans-serif`;
    ctx.textAlign="right";
    ctx.fillText(`${p.p} pi√®ces ¬∑ ${p.c} came${p.c>1?"s":""}`,w-20,h-20);
    
    animId=requestAnimationFrame(draw);
  }
  
  if(animId)cancelAnimationFrame(animId);
  draw();
}

function back(){
  if(animId)cancelAnimationFrame(animId);
  document.getElementById("result").classList.remove("show");
  document.getElementById("app").style.display="flex";
}
</script>
</body>
</html>
