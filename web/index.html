<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>ğŸ”© Automata Generator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,500;0,9..40,700;0,9..40,900;1,9..40,400&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06060a;--s1:#0c0c14;--s2:#13131f;--s3:#1e1e32;--s4:#2a2a44;
  --t1:#e8e6f0;--t2:#7a7894;--t3:#4a4866;
  --ac:#ff6b35;--ac2:#ff8c5a;--acg:rgba(255,107,53,.08);
  --ok:#34d399;--warn:#fbbf24;--err:#f87171;
  --r:12px
}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.mono{font-family:'JetBrains Mono',monospace}
.wrap{max-width:540px;margin:0 auto;padding:12px 16px}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.hdr{display:flex;align-items:center;gap:12px;padding:20px 0 16px}
.hdr-icon{width:44px;height:44px;background:var(--ac);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 20px rgba(255,107,53,.25)}
.hdr-txt h1{font-size:1.35rem;font-weight:900;letter-spacing:-.03em;line-height:1.1}
.hdr-txt p{font-size:.68rem;color:var(--t2);margin-top:1px;letter-spacing:.02em}
.badge{display:inline-flex;align-items:center;gap:3px;background:var(--ok);color:#000;padding:1px 6px;border-radius:4px;font-size:.55rem;font-weight:700;margin-left:6px;letter-spacing:.02em}
.badge::before{content:'';width:5px;height:5px;background:#000;border-radius:50%}

/* â”€â”€â”€ SECTION â”€â”€â”€ */
.sec{margin-bottom:14px}
.sec-h{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.sec-h h2{font-size:.82rem;font-weight:700;display:flex;align-items:center;gap:6px}
.sec-h h2 .dot{width:6px;height:6px;border-radius:50%;background:var(--ac)}
.sec-h .cnt{font-size:.65rem;color:var(--t3);font-family:'JetBrains Mono',monospace}

/* â”€â”€â”€ PRESET GRID â”€â”€â”€ */
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.card{background:var(--s1);border:1.5px solid transparent;border-radius:var(--r);padding:12px;cursor:pointer;transition:all .12s;position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--ac),transparent);opacity:0;transition:opacity .2s}
.card:active{transform:scale(.97)}
.card.sel{border-color:var(--ac);background:var(--acg)}
.card.sel::before{opacity:1}
.card .top{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.card .em{font-size:1.5rem;flex-shrink:0}
.card .nm{font-weight:700;font-size:.82rem;line-height:1.2}
.card .desc{font-size:.65rem;color:var(--t2);line-height:1.3}
.card .tags{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
.tag{font-size:.58rem;padding:2px 5px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-weight:700}
.tag-p{background:rgba(255,107,53,.1);color:var(--ac)}
.tag-c{background:rgba(52,211,153,.1);color:var(--ok)}

/* â”€â”€â”€ TABS â”€â”€â”€ */
.tabs{display:flex;gap:2px;background:var(--s1);border-radius:10px;padding:2px;margin-bottom:14px}
.tab-btn{flex:1;padding:9px 0;border:none;background:none;color:var(--t3);font-size:.72rem;font-weight:700;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s;letter-spacing:.01em}
.tab-btn.on{background:var(--s3);color:var(--t1)}

/* â”€â”€â”€ WIZARD (Custom) â”€â”€â”€ */
.wizard{display:none}
.wizard.show{display:block}
.w-label{font-size:.72rem;color:var(--t2);font-weight:500;margin-bottom:6px;display:block}
.move-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-bottom:14px}
.move-c{background:var(--s1);border:1.5px solid transparent;border-radius:8px;padding:8px 4px;cursor:pointer;text-align:center;font-size:.65rem;font-weight:600;transition:all .12s;color:var(--t2)}
.move-c.sel{border-color:var(--ac);background:var(--acg);color:var(--t1)}
.move-c .me{font-size:1.1rem;margin-bottom:2px}
.range-row{margin-bottom:12px}
.range-row .rh{display:flex;justify-content:space-between;font-size:.72rem;margin-bottom:3px}
.range-row .rh span:first-child{color:var(--t2)}.range-row .rh .rv{color:var(--ac);font-family:'JetBrains Mono',monospace;font-weight:700;font-size:.7rem}
input[type=range]{width:100%;height:4px;-webkit-appearance:none;background:var(--s2);border-radius:2px;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:var(--ac);border-radius:50%;cursor:pointer;box-shadow:0 0 8px rgba(255,107,53,.3)}
.sel-row{margin-bottom:12px}
.sel-row select{width:100%;padding:9px 10px;background:var(--s1);border:1px solid var(--s3);border-radius:8px;color:var(--t1);font-size:.75rem;outline:none;font-family:'DM Sans',sans-serif}

/* â”€â”€â”€ CONFIG PANEL â”€â”€â”€ */
.cfg{background:var(--s1);border-radius:var(--r);overflow:hidden;margin-bottom:12px}
.cfg-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer;-webkit-tap-highlight-color:transparent}
.cfg-head h3{font-size:.75rem;font-weight:700;display:flex;align-items:center;gap:6px}
.cfg-head .arr{color:var(--t3);font-size:.65rem;transition:transform .2s}
.cfg.open .arr{transform:rotate(90deg)}
.cfg-body{display:none;padding:0 12px 12px}
.cfg.open .cfg-body{display:block}
.ch-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:10px}
.ch-c{background:var(--s2);border:1.5px solid transparent;border-radius:6px;padding:6px 2px;cursor:pointer;text-align:center;font-size:.6rem;font-weight:600;transition:all .12s;color:var(--t2)}
.ch-c.sel{border-color:var(--ac);background:var(--acg);color:var(--t1)}
.ch-c .che{font-size:.9rem;margin-bottom:1px}

/* â”€â”€â”€ GO BUTTON â”€â”€â”€ */
.go-zone{position:sticky;bottom:0;padding:6px 0 10px;background:linear-gradient(transparent,var(--bg) 30%);z-index:10}
.go{width:100%;padding:15px;border:none;border-radius:var(--r);font-size:.92rem;font-weight:800;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s;letter-spacing:.01em;position:relative;overflow:hidden}
.go.off{background:var(--s2);color:var(--t3);pointer-events:none}
.go.rdy{background:var(--ac);color:#fff;box-shadow:0 4px 24px rgba(255,107,53,.3)}
.go.rdy:active{transform:scale(.97);box-shadow:0 2px 12px rgba(255,107,53,.2)}

/* â”€â”€â”€ LOADING â”€â”€â”€ */
.page{display:none}.page.vis{display:block;animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
.load-zone{display:flex;flex-direction:column;align-items:center;padding:50px 0;gap:20px}
.spinner{width:48px;height:48px;border:2.5px solid var(--s3);border-top-color:var(--ac);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.load-txt{color:var(--t2);font-size:.8rem;font-weight:500}
.steps{display:flex;flex-direction:column;gap:6px;width:220px}
.step{display:flex;align-items:center;gap:7px;font-size:.72rem;color:var(--t3);transition:all .25s}
.step.on{color:var(--t1)}.step.ok{color:var(--ok)}
.step-dot{width:6px;height:6px;border-radius:50%;background:var(--s4);flex-shrink:0;transition:all .25s}
.step.on .step-dot{background:var(--ac);box-shadow:0 0 8px rgba(255,107,53,.5)}.step.ok .step-dot{background:var(--ok)}

/* â”€â”€â”€ RESULT â”€â”€â”€ */
.res-top{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.res-em{font-size:2rem}
.res-info h2{font-size:1.2rem;font-weight:900;line-height:1.1}
.res-info p{font-size:.7rem;color:var(--t2);margin-top:1px}

/* â”€â”€â”€ 3D CANVAS â”€â”€â”€ */
.cv-wrap{position:relative;background:var(--s1);border-radius:var(--r);overflow:hidden;margin-bottom:12px;aspect-ratio:4/3;border:1px solid var(--s3)}
.cv-wrap canvas{display:block;width:100%;height:100%}
.cv-tag{position:absolute;font-size:.6rem;font-family:'JetBrains Mono',monospace;font-weight:700;padding:2px 6px;border-radius:4px}
.cv-tag.rt{bottom:8px;right:8px;background:rgba(255,107,53,.15);color:var(--ac)}
.cv-tag.lt{bottom:8px;left:8px;background:rgba(52,211,153,.12);color:var(--ok)}
.cv-tag.tp{top:8px;right:8px;color:var(--t3);font-size:.55rem}

/* â”€â”€â”€ STATS â”€â”€â”€ */
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:5px;margin-bottom:12px}
.stat{background:var(--s1);border-radius:8px;padding:10px}
.stat .sk{font-size:.6rem;color:var(--t2);margin-bottom:2px;text-transform:uppercase;letter-spacing:.04em}
.stat .sv{font-size:.88rem;font-weight:800}
.stat .sv.g{color:var(--ok)}.stat .sv.a{color:var(--ac)}

/* â”€â”€â”€ TECH â”€â”€â”€ */
.tech-bar{background:var(--s1);border-radius:var(--r);overflow:hidden;margin-bottom:12px}
.tech-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer}
.tech-head h3{font-size:.72rem;font-weight:700;color:var(--t2)}
.tech-head .arr{color:var(--t3);font-size:.6rem;transition:transform .2s}
.tech-bar.open .arr{transform:rotate(90deg)}
.tech-body{display:none;padding:0 12px 10px;font-size:.62rem;color:var(--t3);line-height:1.8}
.tech-bar.open .tech-body{display:block}
.tech-body b{color:var(--t2)}

.btn-back{width:100%;padding:13px;border:1.5px solid var(--s3);background:transparent;border-radius:var(--r);color:var(--t1);font-size:.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .12s}
.btn-back:active{background:var(--s2)}
</style>
</head>
<body>
<div class="wrap">

<!-- â•â•â•â• PAGE 1: BUILD â•â•â•â• -->
<div class="page vis" id="p1">
  <div class="hdr">
    <div class="hdr-icon">ğŸ”©</div>
    <div class="hdr-txt">
      <h1>Automata Generator<span class="badge">94 TESTS OK</span></h1>
      <p>Automates mÃ©caniques Â· 16 243 lignes Â· Bambu X1C</p>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-btn on" onclick="setTab(0)">Presets</button>
    <button class="tab-btn" onclick="setTab(1)">Custom</button>
  </div>

  <!-- PRESETS -->
  <div id="tab0">
    <div class="sec">
      <div class="sec-h"><h2><span class="dot"></span>Choisis un automate</h2><span class="cnt mono" id="presCnt">10 presets</span></div>
      <div class="grid" id="grid"></div>
    </div>
  </div>

  <!-- CUSTOM -->
  <div id="tab1" style="display:none">
    <div class="wizard show">
      <span class="w-label">Type de mouvement</span>
      <div class="move-grid" id="mgrid"></div>
      <div class="range-row"><div class="rh"><span>Axes</span><span class="rv" id="axV">1</span></div><input type="range" min="1" max="4" value="1" oninput="W.axes=+this.value;$('axV').textContent=this.value"></div>
      <div class="range-row"><div class="rh"><span>Amplitude</span><span class="rv" id="amV">10mm</span></div><input type="range" min="3" max="30" value="10" oninput="W.amp=+this.value;$('amV').textContent=this.value+'mm'"></div>
      <div class="range-row"><div class="rh"><span>Vitesse</span><span class="rv" id="rpV">2.0 RPM</span></div><input type="range" min="5" max="50" value="20" oninput="W.rpm=(+this.value/10);$('rpV').textContent=W.rpm.toFixed(1)+' RPM'"></div>
      <div class="sel-row"><span class="w-label">Loi de mouvement</span><select onchange="W.law=this.value"><option value="cycloidal">CycloÃ¯dal â€” fluide, zÃ©ro Ã -coup</option><option value="harmonic">Harmonique â€” doux, sinusoÃ¯dal</option><option value="poly345">Poly 3-4-5 â€” prÃ©cis, industriel</option><option value="poly4567">Poly 4-5-6-7 â€” premium</option></select></div>
    </div>
  </div>

  <!-- CHASSIS CONFIG -->
  <div class="cfg" id="cfgBox">
    <div class="cfg-head" onclick="toggleCfg()"><h3>âš™ï¸ ChÃ¢ssis & dimensions</h3><span class="arr">â–¸</span></div>
    <div class="cfg-body">
      <div class="ch-grid" id="chGrid"></div>
      <div class="range-row"><div class="rh"><span>Largeur</span><span class="rv" id="wV">80mm</span></div><input type="range" min="40" max="150" value="80" oninput="C.w=+this.value;$('wV').textContent=this.value+'mm'"></div>
      <div class="range-row"><div class="rh"><span>Profondeur</span><span class="rv" id="dV">60mm</span></div><input type="range" min="30" max="120" value="60" oninput="C.d=+this.value;$('dV').textContent=this.value+'mm'"></div>
      <div class="range-row"><div class="rh"><span>Hauteur</span><span class="rv" id="hV">80mm</span></div><input type="range" min="40" max="200" value="80" oninput="C.h=+this.value;$('hV').textContent=this.value+'mm'"></div>
    </div>
  </div>

  <div class="go-zone">
    <button class="go off" id="goBtn" onclick="generate()">Choisis un automate â†‘</button>
  </div>
</div>

<!-- â•â•â•â• PAGE 2: LOADING â•â•â•â• -->
<div class="page" id="p2">
  <div class="hdr"><div class="hdr-icon">ğŸ”©</div><div class="hdr-txt"><h1>Automata Generator</h1></div></div>
  <div class="load-zone"><div class="spinner"></div><p class="load-txt" id="ltxt">GÃ©nÃ©ration...</p><div class="steps" id="lsteps"></div></div>
</div>

<!-- â•â•â•â• PAGE 3: RESULT â•â•â•â• -->
<div class="page" id="p3">
  <div class="hdr"><div class="hdr-icon">ğŸ”©</div><div class="hdr-txt"><h1>Automata Generator</h1></div></div>
  <div class="res-top"><span class="res-em" id="rE"></span><div class="res-info"><h2 id="rN"></h2><p id="rD"></p></div></div>
  <div class="cv-wrap"><canvas id="c3d"></canvas><div class="cv-tag rt" id="cTag"></div><div class="cv-tag lt">âœ“ FDM validÃ©</div><div class="cv-tag tp mono">ROTATION 3D</div></div>
  <div class="stat-grid" id="sGrid"></div>
  <div class="tech-bar" id="techBox">
    <div class="tech-head" onclick="toggleTech()"><h3>âš™ï¸ Sous le capot</h3><span class="arr">â–¸</span></div>
    <div class="tech-body"><b>16 243 lignes</b> Python Â· <b>7 briques</b> (Aâ†’G) Â· Moteur de cames paramÃ©trique Â· Constraint engine <b>94 checks</b> (B1â†’B9) Â· Solveur inverse (differential evolution + L-BFGS-B) Â· <b>22 presets</b> Â· Parser FR/EN Â· Export STL + BOM + timing Â· OptimisÃ© <b>Bambu Lab X1C</b> 256Â³mm Â· 0 crash</div>
  </div>
  <button class="btn-back" onclick="goBack()">â† Choisir un autre</button>
</div>

</div>
<script>
const $=id=>document.getElementById(id);
const P=[
  {id:"nodding_bird",e:"ğŸ¦",n:"Oiseau",d:"TÃªte qui hoche â€” mouvement vertical",p:17,g:79,c:1,t:7,dim:"80Ã—78Ã—75"},
  {id:"flapping_bird",e:"ğŸ¦…",n:"Aigle",d:"Ailes qui battent â€” 3 cames synchronisÃ©es",p:22,g:613,c:3,t:9,dim:"236Ã—235Ã—77"},
  {id:"walking_figure",e:"ğŸš¶",n:"Marcheur",d:"Jambes alternÃ©es â€” gait pattern 4 cames",p:24,g:102,c:4,t:10,dim:"80Ã—61Ã—50"},
  {id:"bobbing_duck",e:"ğŸ¦†",n:"Canard",d:"Plonge et remonte â€” came harmonique",p:16,g:94,c:1,t:6,dim:"80Ã—64Ã—50"},
  {id:"rocking_horse",e:"ğŸ´",n:"Cheval",d:"Bascule douce â€” 2 cames dÃ©phasÃ©es",p:22,g:87,c:2,t:8,dim:"80Ã—60Ã—50"},
  {id:"pecking_chicken",e:"ğŸ”",n:"Poule",d:"Picore le sol â€” corps + tÃªte",p:20,g:134,c:2,t:7,dim:"121Ã—134Ã—50"},
  {id:"waving_cat",e:"ğŸ±",n:"Chat",d:"Patte qui salue â€” maneki-neko",p:18,g:152,c:1,t:6,dim:"157Ã—146Ã—50"},
  {id:"drummer",e:"ğŸ¥",n:"Batteur",d:"Frappe alternÃ©e â€” 2 bras dÃ©phasÃ©s 180Â°",p:21,g:225,c:2,t:8,dim:"161Ã—132Ã—50"},
  {id:"blacksmith",e:"âš’ï¸",n:"Forgeron",d:"Marteau sur enclume â€” came asymÃ©trique",p:17,g:268,c:1,t:7,dim:"237Ã—250Ã—50"},
  {id:"swimming_fish",e:"ğŸŸ",n:"Poisson",d:"Queue ondulante â€” nage fluide",p:18,g:88,c:1,t:6,dim:"80Ã—60Ã—73"},
];
const MOVES=[{e:"â†•ï¸",n:"Hochement"},{e:"ğŸŒŠ",n:"Vague"},{e:"â†”ï¸",n:"GlissiÃ¨re"},{e:"ğŸ¦…",n:"Battement"},{e:"ğŸ”¨",n:"Frappe"},{e:"âš™ï¸",n:"GenÃ¨ve"}];
const CH=[{id:"box",e:"ğŸ“¦",n:"BoÃ®te"},{id:"frame",e:"ğŸ—ï¸",n:"Cadre"},{id:"central",e:"ğŸ—¼",n:"Central"},{id:"flat",e:"ğŸ“‹",n:"Plat"}];
let sel=null,tab=0,anim=null;
let W={move:0,axes:1,amp:10,rpm:2,law:"cycloidal"};
let C={type:"box",w:80,d:60,h:80};

// Build preset cards
P.forEach((p,i)=>{const d=document.createElement("div");d.className="card";d.innerHTML=`<div class="top"><span class="em">${p.e}</span><span class="nm">${p.n}</span></div><div class="desc">${p.d}</div><div class="tags"><span class="tag tag-p">${p.p} piÃ¨ces</span><span class="tag tag-c">${p.c} came${p.c>1?"s":""}</span></div>`;d.onclick=()=>{sel=i;document.querySelectorAll(".card").forEach((c,j)=>c.classList.toggle("sel",j===i));updBtn()};$("grid").appendChild(d)});

// Build move grid
MOVES.forEach((m,i)=>{const d=document.createElement("div");d.className="move-c"+(i===0?" sel":"");d.innerHTML=`<div class="me">${m.e}</div>${m.n}`;d.onclick=()=>{W.move=i;document.querySelectorAll(".move-c").forEach((c,j)=>c.classList.toggle("sel",j===i));updBtn()};$("mgrid").appendChild(d)});

// Build chassis grid
CH.forEach((c,i)=>{const d=document.createElement("div");d.className="ch-c"+(i===0?" sel":"");d.dataset.id=c.id;d.innerHTML=`<div class="che">${c.e}</div>${c.n}`;d.onclick=()=>{C.type=c.id;document.querySelectorAll(".ch-c").forEach(x=>x.classList.toggle("sel",x.dataset.id===c.id))};$("chGrid").appendChild(d)});

function setTab(t){tab=t;document.querySelectorAll(".tab-btn").forEach((b,i)=>b.classList.toggle("on",i===t));$("tab0").style.display=t===0?"block":"none";$("tab1").style.display=t===1?"block":"none";updBtn()}
function updBtn(){const b=$("goBtn");if(tab===0&&sel!==null){b.className="go rdy";b.textContent=`GÃ©nÃ©rer ${P[sel].n} âš¡`}else if(tab===1){b.className="go rdy";b.textContent="GÃ©nÃ©rer Custom âš¡"}else{b.className="go off";b.textContent="Choisis un automate â†‘"}}
function toggleCfg(){$("cfgBox").classList.toggle("open")}
function toggleTech(){$("techBox").classList.toggle("open")}
function showPage(n){["p1","p2","p3"].forEach((id,i)=>{$(id).classList.toggle("vis",i===n)});window.scrollTo(0,0)}

async function generate(){
  showPage(1);
  const steps=["Validation scÃ¨ne","Compilation cames","Optimisation phases","Calcul couples moteur","GÃ©omÃ©trie 3D","Validation FDM","Export STL"];
  $("lsteps").innerHTML=steps.map(s=>`<div class="step"><div class="step-dot"></div>${s}</div>`).join("");
  const ls=$("lsteps").querySelectorAll(".step");
  for(let i=0;i<steps.length;i++){ls[i].className="step on";$("ltxt").textContent=steps[i]+"...";await new Promise(r=>setTimeout(r,180+Math.random()*300));ls[i].className="step ok"}
  await new Promise(r=>setTimeout(r,200));
  let d;if(tab===0&&sel!==null){d=P[sel]}else{d={e:"ğŸ› ï¸",n:"Custom",d:MOVES[W.move].n+` Â· ${W.axes} axe(s) Â· ${W.amp}mm`,p:8+W.axes*5,g:Math.round(60+W.amp*W.axes*3),c:W.axes,t:Math.round(5+W.axes*2),dim:`${C.w}Ã—${C.d}Ã—${C.h}`}}
  showResult(d)
}

function showResult(d){
  showPage(2);$("rE").textContent=d.e;$("rN").textContent=d.n;$("rD").textContent=d.d;$("cTag").textContent=`${d.p}p Â· ${d.c} came${d.c>1?"s":""}`;
  const stats=[
    {k:"PIÃˆCES STL",v:d.p,c:"a"},{k:"CAMES",v:d.c,c:"a"},
    {k:"PLA",v:d.g+"g",c:""},{k:"IMPRESSION",v:"~"+d.t+"h",c:""},
    {k:"DIMENSIONS",v:d.dim||`${C.w}Ã—${C.d}Ã—${C.h}`,c:""},{k:"IMPRIMANTE",v:"X1C âœ“",c:"g"},
    {k:"VALIDATION FDM",v:`${d.p}/${d.p} âœ“`,c:"g"},{k:"CHÃ‚SSIS",v:C.type.toUpperCase(),c:""},
  ];
  $("sGrid").innerHTML=stats.map(s=>`<div class="stat"><div class="sk">${s.k}</div><div class="sv${s.c?" "+s.c:""}">${s.v}</div></div>`).join("");
  render3D(d)
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   3D RENDERER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render3D(p){
  const cv=$("c3d");const dpr=Math.min(window.devicePixelRatio||1,2);
  cv.width=cv.offsetWidth*dpr;cv.height=cv.offsetHeight*dpr;
  const ctx=cv.getContext("2d");const w=cv.width,h=cv.height;let f=0;

  function draw(){
    f++;ctx.clearRect(0,0,w,h);
    // BG
    const bg=ctx.createRadialGradient(w/2,h*.52,0,w/2,h*.52,w*.65);
    bg.addColorStop(0,"#0f0f1a");bg.addColorStop(1,"#06060a");
    ctx.fillStyle=bg;ctx.fillRect(0,0,w,h);

    const cx=w/2,cy=h*.54,sc=w/420,rot=f*.005,cr=Math.cos(rot),sr=Math.sin(rot);
    const proj=(x,y,z)=>[cx+(x*cr-y*sr*.55)*sc, cy+(-z*.82+x*sr*.32+y*cr*.32)*sc];

    // â”€â”€ GRID â”€â”€
    ctx.globalAlpha=.15;ctx.strokeStyle="#ff6b35";ctx.lineWidth=.4*sc;
    for(let i=-7;i<=7;i++){
      let[x1,y1]=proj(i*18,-140,0),[x2,y2]=proj(i*18,140,0);ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
      [x1,y1]=proj(-140,i*18,0);[x2,y2]=proj(140,i*18,0);ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()
    }
    ctx.globalAlpha=1;

    const bw=C.w*.6,bd=C.d*.6,bh=C.h*.55;
    // â”€â”€ BOX FACES â”€â”€
    const bx=[[-bw/2,-bd/2,0],[bw/2,-bd/2,0],[bw/2,bd/2,0],[-bw/2,bd/2,0],[-bw/2,-bd/2,bh],[bw/2,-bd/2,bh],[bw/2,bd/2,bh],[-bw/2,bd/2,bh]].map(c=>proj(...c));
    // Filled faces with depth sorting
    const faces=[[0,1,5,4,"rgba(255,107,53,.04)"],[1,2,6,5,"rgba(255,107,53,.025)"],[2,3,7,6,"rgba(255,107,53,.02)"],[4,5,6,7,"rgba(255,107,53,.06)"]];
    faces.forEach(([a,b,c,d,col])=>{ctx.fillStyle=col;ctx.beginPath();ctx.moveTo(bx[a][0],bx[a][1]);ctx.lineTo(bx[b][0],bx[b][1]);ctx.lineTo(bx[c][0],bx[c][1]);ctx.lineTo(bx[d][0],bx[d][1]);ctx.closePath();ctx.fill()});
    // Edges
    ctx.strokeStyle="rgba(255,107,53,.35)";ctx.lineWidth=1.5*sc;
    [[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]].forEach(([a,b])=>{ctx.beginPath();ctx.moveTo(bx[a][0],bx[a][1]);ctx.lineTo(bx[b][0],bx[b][1]);ctx.stroke()});
    // Panel lines
    ctx.strokeStyle="rgba(255,107,53,.08)";ctx.lineWidth=.6*sc;
    for(let i=1;i<5;i++){const t=i/5;let[x1,y1]=proj(-bw/2,-bd/2,bh*t),[x2,y2]=proj(bw/2,-bd/2,bh*t);ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();[x1,y1]=proj(bw/2,-bd/2,bh*t);[x2,y2]=proj(bw/2,bd/2,bh*t);ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}

    // â”€â”€ SHAFT â”€â”€
    const sz=bh*.5,sl=bd*.85;
    let[s1x,s1y]=proj(0,-sl,sz),[s2x,s2y]=proj(0,sl,sz);
    ctx.strokeStyle="rgba(255,255,255,.18)";ctx.lineWidth=3*sc;ctx.beginPath();ctx.moveTo(s1x,s1y);ctx.lineTo(s2x,s2y);ctx.stroke();
    // Bearings
    [[-sl],[sl]].forEach(([sy])=>{let[bxx,by]=proj(0,sy,sz);ctx.fillStyle="rgba(255,107,53,.12)";ctx.strokeStyle="rgba(255,107,53,.3)";ctx.lineWidth=1.5*sc;ctx.beginPath();ctx.arc(bxx,by,5*sc,0,Math.PI*2);ctx.fill();ctx.stroke()});

    // â”€â”€ CAMS â”€â”€
    const camC=["#ff6b35","#ff8c5a","#ffad85","#ffd0b5"];
    for(let ci=0;ci<Math.min(p.c,4);ci++){
      const ca=f*.018+ci*Math.PI*.65,sp=Math.min(p.c,4),off=(ci-(sp-1)/2)*(bd*.4/Math.max(sp-1,1)),br=26-ci*2;
      let[ccx,ccy]=proj(0,off,sz);
      // Cam profile - glow
      ctx.strokeStyle=camC[ci];ctx.lineWidth=2.5*sc;ctx.shadowColor=camC[ci];ctx.shadowBlur=12*sc;
      ctx.beginPath();
      for(let i=0;i<=72;i++){const a=(i/72)*Math.PI*2;const r=(br+9*Math.sin(a*2+ca)+4*Math.sin(a*3+ca*1.3)+2.5*Math.cos(a*5+ca*.7))*sc;const px=ccx+r*Math.cos(a)*cr*.65;const py=ccy+r*Math.sin(a)*.52;i===0?ctx.moveTo(px,py):ctx.lineTo(px,py)}
      ctx.closePath();ctx.stroke();ctx.shadowBlur=0;
      // Fill
      ctx.fillStyle=camC[ci]+"10";ctx.fill();
      // Center
      ctx.fillStyle=camC[ci]+"40";ctx.beginPath();ctx.arc(ccx,ccy,3.5*sc,0,Math.PI*2);ctx.fill();
      // D-flat
      ctx.strokeStyle=camC[ci]+"50";ctx.lineWidth=1*sc;ctx.beginPath();ctx.moveTo(ccx-2*sc,ccy-3*sc);ctx.lineTo(ccx-2*sc,ccy+3*sc);ctx.stroke();

      // â”€â”€ FOLLOWER â”€â”€
      const cd=9*Math.sin(ca)+4*Math.sin(ca*1.3);const ftZ=sz+br+cd+16;
      let[ftx,fty]=proj(0,off,ftZ),[fbx,fby]=proj(0,off,sz+br+1);
      ctx.strokeStyle="#fbbf24";ctx.lineWidth=2*sc;ctx.beginPath();ctx.moveTo(fbx,fby);ctx.lineTo(ftx,fty);ctx.stroke();
      ctx.fillStyle="rgba(251,191,36,.2)";ctx.strokeStyle="#fbbf24";ctx.lineWidth=1.5*sc;ctx.beginPath();ctx.arc(fbx,fby,3.5*sc,0,Math.PI*2);ctx.fill();ctx.stroke();

      // â”€â”€ FIGURINE â”€â”€
      const fZ=ftZ+6,bob=cd*.5;let[px,py]=proj(0,off,fZ+bob);
      ctx.fillStyle="#fbbf24";ctx.shadowColor="#fbbf24";ctx.shadowBlur=6*sc;
      ctx.beginPath();ctx.arc(px,py-10*sc,5.5*sc,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
      ctx.strokeStyle="rgba(251,191,36,.45)";ctx.lineWidth=1.8*sc;
      ctx.beginPath();ctx.moveTo(px,py-4*sc);ctx.lineTo(px,py+15*sc);ctx.stroke();
      const arm=Math.sin(f*.022+ci)*.35;
      ctx.beginPath();ctx.moveTo(px-11*sc*Math.cos(arm),py+1*sc-7*sc*Math.sin(arm));ctx.lineTo(px,py+1*sc);ctx.lineTo(px+11*sc*Math.cos(-arm),py+1*sc+7*sc*Math.sin(arm));ctx.stroke();
      ctx.beginPath();ctx.moveTo(px,py+15*sc);ctx.lineTo(px-5*sc,py+26*sc);ctx.moveTo(px,py+15*sc);ctx.lineTo(px+5*sc,py+26*sc);ctx.stroke()
    }

    // â”€â”€ MOTOR â”€â”€
    let[mx,my]=proj(bw/2+14,-bd/2+8,bh*.18);
    ctx.fillStyle="rgba(255,107,53,.08)";ctx.strokeStyle="rgba(255,107,53,.25)";ctx.lineWidth=1.5*sc;ctx.beginPath();ctx.arc(mx,my,9*sc,0,Math.PI*2);ctx.fill();ctx.stroke();
    ctx.fillStyle="rgba(255,107,53,.3)";ctx.font=`bold ${9*sc}px 'DM Sans',sans-serif`;ctx.textAlign="center";ctx.fillText("M",mx,my+3.5*sc);
    // Belt
    let[dx,dy]=proj(bw/2+5,-bd/2+8,sz);ctx.strokeStyle="rgba(255,107,53,.1)";ctx.lineWidth=1*sc;ctx.setLineDash([3*sc,3*sc]);ctx.beginPath();ctx.moveTo(mx,my-9*sc);ctx.lineTo(dx,dy);ctx.stroke();ctx.setLineDash([]);

    // â”€â”€ CRANK â”€â”€
    const cA=f*.018;let[hx,hy]=proj(0,-sl-10,sz);
    ctx.strokeStyle="rgba(255,255,255,.15)";ctx.lineWidth=2*sc;ctx.beginPath();ctx.moveTo(hx,hy);ctx.lineTo(hx+13*sc*Math.cos(cA),hy+13*sc*Math.sin(cA));ctx.stroke();
    ctx.fillStyle="rgba(255,255,255,.12)";ctx.beginPath();ctx.arc(hx+13*sc*Math.cos(cA),hy+13*sc*Math.sin(cA),3*sc,0,Math.PI*2);ctx.fill();

    // â”€â”€ SCREWS â”€â”€
    ctx.fillStyle="rgba(255,107,53,.1)";
    [[-bw/2+4,-bd/2+4],[bw/2-4,-bd/2+4],[-bw/2+4,bd/2-4],[bw/2-4,bd/2-4]].forEach(([sx,sy])=>{let[px2,py2]=proj(sx,sy,0);ctx.beginPath();ctx.arc(px2,py2,2*sc,0,Math.PI*2);ctx.fill()});

    anim=requestAnimationFrame(draw)
  }
  if(anim)cancelAnimationFrame(anim);draw()
}

function goBack(){if(anim)cancelAnimationFrame(anim);showPage(0)}
</script>
</body>
</html>
